# 分享功能文档

## 功能概述

P-43 分享功能已完成开发，提供了一个统一的分享界面，支持多种导出格式和在线分享方式。

## 主要功能

### 1. 导出功能

#### PDF 导出
- **文件格式**: PDF
- **用途**: 适合打印和存档
- **包含内容**: 
  - 计划基本信息（标题、描述、时间范围）
  - 进度统计和可视化
  - 执行路径详情
  - 里程碑列表
  - 团队成员信息
  - 标签信息
  - 二维码（如果有分享链接）

#### 图片导出
- **支持格式**: PNG / JPEG
- **用途**: 社交媒体分享、演示文稿
- **特点**: 
  - PNG: 高质量，无损压缩
  - JPEG: 压缩格式，文件更小
  - 包含与PDF相同的内容布局

### 2. 在线分享

#### 分享链接生成
- **功能**: 生成公开访问链接
- **特点**: 
  - 任何人都可以通过链接查看计划
  - 只读模式，保护原始数据
  - 链接包含时间戳，确保唯一性

#### 只读分享页面
- **路径**: `/share/[id]`
- **特点**:
  - 美观的展示界面
  - 完整的计划信息展示
  - 明确的只读模式标识
  - 品牌化页脚

### 3. 其他分享方式
- **二维码**: 自动生成分享链接的二维码
- **邮件分享**: 预留接口
- **短信分享**: 预留接口

## 技术实现

### 核心文件

1. **`components/core/ShareModal.tsx`**
   - 分享功能的主界面
   - 统一管理所有分享选项
   - 响应式设计，支持移动端

2. **`lib/export-utils.ts`**
   - 导出功能的核心逻辑
   - PDF 生成（使用 jsPDF + html2canvas）
   - 图片生成（使用 html2canvas）
   - 二维码生成（使用 qrcode）
   - 分享链接生成

3. **`app/share/[id]/page.tsx`**
   - 只读分享页面
   - 动态路由处理
   - 计划数据展示

### 依赖包

```json
{
  "html2canvas": "^1.4.1",    // 网页截图
  "jspdf": "^2.5.1",          // PDF 生成
  "qrcode": "^1.5.3",         // 二维码生成
  "@types/qrcode": "^1.5.2"   // TypeScript 类型
}
```

### 数据流程

1. **导出流程**:
   ```
   用户点击导出 → 创建临时HTML → 生成图片/PDF → 自动下载
   ```

2. **分享流程**:
   ```
   用户点击分享 → 生成分享ID → 返回分享链接 → 复制或其他分享方式
   ```

3. **访问流程**:
   ```
   访问分享链接 → 解析分享ID → 获取计划数据 → 展示只读页面
   ```

## 使用说明

### 如何分享计划

1. 在计划详情页面点击右上角的"分享"按钮
2. 选择需要的分享方式：
   - **导出文件**: 选择 PDF、PNG 或 JPEG 格式
   - **在线分享**: 点击"生成分享链接"

### 分享链接的使用

- 生成的分享链接可以发送给任何人
- 接收者无需登录即可查看计划内容
- 分享页面为只读模式，不能编辑计划

### 导出文件的特点

- **PDF**: 适合正式文档、打印输出
- **PNG**: 适合网页展示、高质量图片需求
- **JPEG**: 适合社交媒体、文件大小敏感场景

## 用户体验设计

### 界面设计
- 遵循 Apple Design 指南
- 清晰的功能分类（导出 vs 分享）
- 直观的图标和说明文字
- 响应式布局，适配不同设备

### 交互设计
- 加载状态指示
- 实时反馈（Toast 通知）
- 一键复制分享链接
- 优雅的动画过渡

### 错误处理
- 网络异常处理
- 文件生成失败提示
- 浏览器兼容性检查

## 安全考虑

### 数据保护
- 分享链接不包含敏感信息
- 只读页面防止数据篡改
- 分享ID与计划ID分离

### 访问控制
- 分享功能仅限计划成员使用
- 可以考虑添加分享链接过期机制
- 预留权限扩展接口

## 未来扩展

### 短期计划
- 添加分享链接访问统计
- 支持分享链接过期设置
- 增加更多导出模板

### 长期计划
- 支持批量导出多个计划
- 集成第三方分享平台
- 添加评论功能到分享页面

## 测试建议

### 功能测试
1. 测试各种导出格式的文件质量
2. 验证分享链接的有效性
3. 检查不同设备上的显示效果

### 性能测试
1. 大型计划的导出性能
2. 高并发分享链接生成
3. 移动端加载速度

### 兼容性测试
1. 不同浏览器的兼容性
2. 移动设备的响应式表现
3. 打印功能的兼容性

---

**开发完成时间**: 2025-01-14  
**负责模块**: P-43 分享功能  
**状态**: ✅ 已完成 