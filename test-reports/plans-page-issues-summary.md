# 计划页面测试问题汇总

## 🔍 问题详情

### #001 计划创建失败

**位置**: `/plans/create` → 创建计划按钮  
**现象**: 点击"创建计划"后显示"创建失败，请稍后重试"  
**影响**: 用户无法创建新计划，核心功能受阻  

**快速复现**:
1. 访问 `/plans/create`
2. 填写必要信息
3. 点击"创建计划"
4. 观察错误提示

**可能原因**:
- API端点问题
- 数据库连接问题  
- 数据验证失败
- 权限验证问题

**修复建议**:
1. 检查 `/api/plans` POST端点
2. 验证数据库连接
3. 查看服务器错误日志
4. 测试API数据格式

## 🚨 问题 #002: 分享功能导出失败
在计划详情页面的分享功能中，所有导出文件格式（PDF、PNG、JPEG）都出现导出失败问题。请进行以下操作：

1. **问题验证和复现**：
   - 访问任意计划详情页面（如 `/plans/[id]`）
   - 点击页面右上角的"分享"按钮
   - 依次测试PDF、PNG、JPEG三种导出格式
   - 记录每种格式的具体错误信息和行为

2. **错误分析**：
   - 具体错误信息：`导出失败: TypeError: Cannot read properties of undefined (reading 'length')`
   - 在浏览器开发者工具中检查Console标签页的完整错误堆栈
   - 检查Network标签页是否有相关的网络请求失败
   - 确定错误发生在前端JavaScript代码中的具体位置

3. **代码检查重点**：
   - 检查与导出功能相关的组件文件（可能在分享对话框组件中）
   - 重点检查jsPDF和html2canvas库的使用方式
   - 查找可能未定义的数组或对象，特别是在访问`.length`属性之前
   - 验证页面DOM元素是否正确获取

4. **更新测试报告**：
   - 将问题#002的严重程度从"中"提升为"高"，因为影响所有导出格式
   - 在问题描述中添加具体的错误信息
   - 更新影响范围：从"PDF导出失败"扩展为"所有导出格式失败"
   - 调整修复优先级和预计修复时间

5. **提供修复建议**：
   - 基于错误信息提供具体的代码修复方向
   - 建议添加适当的错误处理和数据验证
   - 推荐测试步骤确保修复后所有格式都能正常导出

## 🚨 问题 #003: 里程碑状态更新UI同步问题

在计划详情页面的执行路径标签页中发现里程碑状态更新的UI同步问题。

**问题描述**：
1. 初始状态：执行路径"先叫老公"中有两个里程碑，都显示为已完成状态
2. 操作：点击其中一个里程碑的通用标记按钮，标记为未完成(反选，如果是已完成再点击就是未完成)
3. 预期结果：该里程碑应该显示为未完成状态，另一个里程碑保持已完成状态
4. 实际结果：页面UI仍然显示两个里程碑都是已完成状态（UI未更新）
5. Toast通知：显示了两条消息
   - Info: "状态更新: 里程碑 '叫老公' 已标记为完成"
   - Success: "里程碑已更新: 里程碑状态：已完成"

**测试要求**：
1. 导航到计划详情页面 (URL: /plans/5717afd8-f45c-47f4-9beb-6b464d63f03e)
2. 切换到"执行路径"标签页
3. 找到里程碑管理区域
4. 测试里程碑状态切换功能（完成 ↔ 未完成）
5. 验证UI状态是否正确同步更新
6. 检查Toast通知消息的准确性
7. 将此问题记录为新的测试问题，并更新相关测试报告文档

**重点关注**：
- UI状态同步问题
- Toast消息与实际操作的一致性
- 前端状态管理是否正确

## 🚨 问题 #004: 计划详情页面 - 概览tab栏
在计划详情页面的概览标签页中，发现了一个数据同步问题需要记录到测试报告中：

**问题描述**: "任务进度"统计卡片显示的数据与实际执行路径中的任务数量不同步。

**具体问题**: 
- 当前显示: "任务进度: 0/2"
- 实际情况: 执行路径中有x个里程碑/任务
- 预期行为: 应该显示为 "n/x"，其中x是执行路径中的总任务数，n是已完成的任务数

**测试位置**: `/plans/[id]` → 概览标签页 → 任务进度统计卡片

请将此问题作为新的问题项目添加到测试报告中，包括：
1. 问题编号 (#004)
2. 严重程度评估 (建议为🟡中等，因为影响数据准确性但不阻塞核心功能)
3. 详细的复现步骤
4. 预期行为与实际行为的对比
5. 修复建议 (检查前端数据绑定逻辑，确保任务进度与执行路径数据同步)


## 005 计划详情页面概览模块的用户体验问题：

**问题描述**：在计划详情页面的概览模块中发现两个显示问题需要优化：

1. **分类信息显示不一致**：
   - 当前显示：英文 "research" 
   - 期望显示：中文 "学术研究"（与创建计划时的分类选项保持一致）
   - 问题：英文显示对中文用户不够友好，应该使用创建时选择的中文分类名称

2. **预算显示格式冗余**：
   - 当前显示：进度格式 "¥0/100"
   - 期望显示：简化格式 "预算 ¥100"
   - 问题：当前格式暗示这是使用进度，但实际上应该只显示总预算金额

**严重程度**：🟢 低（用户体验优化）
**影响范围**：计划详情页面概览模块
**修复优先级**：P3（用户体验改进）

## 006 计划列表页面性能优化问题 

请分析并优化计划页面的数据加载和缓存策略，解决页面路由切换时的性能问题。具体要求：

**问题描述**：
- 从计划列表页(`/plans`)点击"新建"按钮进入创建页面(`/plans/create`)
- 中途从创建页面返回计划列表页时，页面会重新查询后端数据
- 用户每次返回都需要等待2-3秒的加载时间，影响用户体验

**优化目标**：
1. 减少不必要的后端数据请求
2. 保持短暂的骨架屏加载效果（提升感知性能）
3. 实现智能的数据更新策略

**建议的优化方案**（请选择最佳方案或提出更好的替代方案）：
1. **条件刷新策略**：检测用户是否实际创建了新计划，如果没有创建则使用缓存数据
2. **下拉刷新机制**：允许用户主动下拉刷新获取最新数据
3. **增量更新**：只更新发生变化的数据项，而不是重新加载整个列表
4. **前端状态管理**：使用Zustand等状态管理工具缓存计划列表数据

**技术要求**：
- 分析当前的数据获取逻辑和缓存机制
- 提出具体的代码实现方案
- 考虑数据一致性和用户体验的平衡
- 提供性能优化的测试验证方法

**预期结果**：
- 页面切换响应时间从2-3秒降低到500ms以内
- 保持数据的准确性和一致性
- 提升整体用户体验和应用性能

